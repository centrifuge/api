specVersion: 1.0.0
name: centrifuge-pools
version: 1.0.0
runner:
  node:
    name: '@subql/node-ethereum'
    version: '3'
  query:
    name: '@subql/query'
    version: '2'
description: 'SubQuery API powered by EMBRIO.tech to query Centrifuge chain data for analytics insights on how Centrifuge is unlocking economic opportunity for all by connecting people to borrow and lend money transparently and cost-effectively.'
repository: https://github.com/centrifuge/pools-subql
schema:
  file: './schema.graphql'
dataSources:
  - kind: ethereum/Runtime
    startBlock: 11063000
    options:
      abi: navFeed
    assets:
      navFeed:
        file: './abi/navfeed.abi.json'
      reserve:
        file: './abi/reserve.abi.json'
      shelf:
        file: './abi/shelf.abi.json'
      pile:
        file: './abi/pile.abi.json'
    mapping:
      file: './dist/index.js'
      abis:
        - file: './abi/navfeed.abi.json'
          name: NavFeed
        - file: './abi/reserve.abi.json'
          name: Reserve
        - file: './abi/shelf.abi.json'
          name: Shelf
        - file: './abi/pile.abi.json'
          name: Pile
      handlers:
        - handler: handleEvmBlock
          kind: ethereum/BlockHandler
          filter:
            modulo: 6000
  - kind: ethereum/Runtime
    startBlock: 18063000
    options:
      abi: poolManager
    assets:
      poolManager:
        file: './abi/poolManager.abi.json'
      investmentManager:
        file: './abi/investmentManager.abi.json'
    mapping:
      file: './dist/index.js'
      handlers:
        - handler: handleEvmDeployTranche
          kind: ethereum/LogHandler
          filter:
            topics:
              - DeployTranche(uint64 indexed poolId, bytes16 indexed trancheId, address indexed token)
templates:
  - name: TrancheTracker
    kind: ethereum/Runtime
    options:
      abi: erc20
    assets:
      erc20:
        file: './abi/erc20.abi.json'
    mapping:
      file: ./dist/index.js
      handlers:
        - handler: handleEvmTransfer
          kind: ethereum/LogHandler
          filter:
            topics:
              - Transfer(address indexed from, address indexed to, uint256 value)
